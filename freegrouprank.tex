\documentclass{article}

% Package `amsthm` and `thmtools` must come before package `hyperref`.
\usepackage{amsthm}
\usepackage{thmtools}
% Package `hyperref` must come before package `complexity`.
\usepackage[pdftitle={The Folded Density Problem is P-complete}, pdfauthor={Jeffrey Finkelstein}]{hyperref}
\usepackage{complexity}
\usepackage{amsmath}
\usepackage{amssymb}

\declaretheorem[numberwithin=section]{theorem}
\declaretheorem[numberlike=theorem]{corollary}
\declaretheorem[numberlike=theorem]{lemma}
\declaretheorem[numberlike=theorem, style=definition]{definition}

\newcommand{\FGR}{\textsc{Free Group Rank}}
\newcommand{\FD}{\textsc{Folded Density}}
\newcommand{\triple}[3]{\langle #1, #2, #3 \rangle}
\newcommand{\quint}[5]{\langle #1, #2, #3, #4, #5 \rangle}
\newcommand{\gen}[1]{\langle #1 \rangle}

\author{Jef{}frey~Finkelstein}
\title{The Folded Density Problem is \P-complete}
\date{\today}

\begin{document}

\maketitle

\abstract{}

\section{Introduction}

The problem of computing the minimum rank of a finitely generated subgroup of a free group is \P-complete.
One way of computing the minimum rank of the subgroup is by computing the size of a Nielsen reduced set equivalent to the generating set of the subgroup.
The Nielsen reduction, however, is complicated and relatively inefficient.
It is more efficient to instead reduce the problem to a more easily solved graph problem.
A finitely generated subgroup of a free group has a natural representation as a directed, labeled graph.

\section{Preliminaries}

If $S$ is an alphabet, we define $S^{-1}$ as $\{ s^{-1} | s \in S \}$.
If $w$ is a word in $(S \cup S^{-1})^*$, the length of $w$, denoted $|w|$, is the number of symbols from $S \cup S^{-1}$ in $w$.
The word $w$ can be expressed as $w_1w_2\cdots w_n$ where each $w_i \in (S \cup S^{-1})$.
A word is \emph{freely reduced} if it contains no adjacent symbols which are inverses.
The free group on $S$, denoted $\mathcal{F}_S$, is the set of freely reduced words on $S \cup S^{-1}$.
Each word on $S \cup S^{-1}$ has a unique, freely reduced representation.
We denote this freely reduced representative of the word $w$ by $\rho(w)$.
If $A$ is a set of words, we define $\rho(A)$ by $\rho(A) = \{ \rho(a) \, | \, a \in A\}$.
A finitely generated subgroup of $\mathcal{F}_S$ is the closure of a finite set of words on $S$ under concatenation (with free reduction).
If $U$ is a finite set of words, the subgroup generated by $U$ is denoted $\gen{U}$.
The \emph{rank} of a finitely generated subgroup is the size of a minimum generating set.

If $G$ is a directed graph, we denote the vertex set of $G$ by $V(G)$ and the edge set of $G$ by $E(G)$.
The \emph{additive density} of $G$, denoted $\delta(G)$, is defined by $\delta(G) = |E(G)| - |V(G)|$ for all graphs $G$.
We say $G$ is labeled by $S$ if there exists a function $\mu \colon E(G) \to S$.
%% TODO better definitions of minimal spanning trees
A \emph{tree} $T$ is an acyclic subgraph of $G$.
A tree is \emph{spanning} if $|V(T)| = |V(G)|$.
A spanning tree is \emph{minimal} if no edges can be removed without violating the spanning property.
A directed graph $G$ labeled by $S$ is \emph{folded} if for each vertex $v \in V(G)$ and each symbol $s \in S$, there is at most one edge in $E(G)$ with origin $v$ and label $s$ and there is at most one edge in $E(G)$ with terminus $v$ and label $s$.
Stated another way, $G$ is folded if there is no vertex $v \in V(G)$ such that $v$ has two (or more) in-edges with the same label or two (or more) out-edges with the same label.
%% TODO state that every graph has a folded representative, F(G)
%% TODO describe reduced path
%% TODO describe core of a graph

\begin{definition}[\FGR]
  \mbox{}

  \textbf{Instance}: finite alphabet $S$, finite set $U \subseteq (S \cup S^{-1})^*$, positive integer $k$.

  \textbf{Question}: Does $\gen{U}$ have rank $k$ or less?
\end{definition}

\begin{definition}[\FD]
  \mbox{}

  \textbf{Instance}: finite alphabet $S$, directed graph $G$ labeled by $S$, a vertex $v \in V(G)$ such that $G$ is a core graph with respect to $v$, integer $k$.

  \textbf{Question}: Does $F(G)$ have additive density at most $k$?
\end{definition}

\begin{lemma}\label{lem:tree}
  Let $G$ be a graph with vertex set $V$ and edge set $E$.
  If $T$ is a minimal spanning tree of $G$ then $|E(T)| = |V(G)| - 1$.
\end{lemma}
\begin{proof}
  This proof is by induction on the number of vertices in the graph.
  Let $T_n$ denote a minimal spanning tree on a graph $G_n$ with $n$ vertices.
  For the base case, consider the graph on one vertex with no edges.
  In this case, the minimal spanning tree $T_1$ is the empty tree, so
  \begin{equation*}
    0 = |E(T_1)| = |V(G)| - 1 = 1 - 1 = 0.
  \end{equation*}
  For the inductive step, suppose that for graphs with $i$ vertices, we have $|E(T_i)| = |V(G_i)| - 1$.
  Consider a minimal spanning tree $T_{i + 1}$ of a graph $G_{i + 1}$ on $i + 1$ vertices.
  Now the subgraph of $T_{i + 1}$ which is just $T_{i + 1}$ with a single leaf removed, call it $T_i$, is a minimal spanning tree of a subgraph of $G_{i + 1}$ which has $i$ vertices, call it $G_i$.
  By the inductive hypothesis, $|E(T_i)| = |V(G_i)| - 1$.
  This implies $|E(T_{i + 1})| = |E(T_i)| + 1 = |V(G_i)| = |V(G_{i + 1})| - 1$, which concludes the proof.
\end{proof}

\section{Results}

\begin{theorem}[{\cite[Problem~A.8.11]{ghr95}}]
  $\FGR$ is \P-complete.
\end{theorem}

We restate in the language of complexity theory a result implicit in \cite{km02}.
\begin{theorem}
  $\FGR \leq_m^L \FD$.
\end{theorem}
\begin{proof}
  The reduction proceeds as follows on input $\triple{S}{U}{k}$ where $U$ is a finite set of words $\{u_1, u_2, \dotsc, u_m\}$ and for each $i$ with $1 \leq i \leq m$ we have $u_i = u_{i, 1}u_{i, 2}\dotsb u_{i, n}$ where $n$ is the length of $u_i$.
  Create and output a directed graph $G$ which is a bouquet of circles centered at a distinguished vertex $v_0$.
  There is one circle for each word $u$ in $U$, and each circle is divided into $|u|$ edges, one for each symbol of $u$.
  Wherever $u$ contains an inverse $s^-1$ of a symbol in $S$, that edge is reversed.
  Each edge of the circle is then labeled (by defining a labelling function $\mu$) with the corresponding symbol in $u$, or its inverse when the edge has been reversed.
  Output $\quint{S}{G}{\mu}{v_0}{k - 1}$.
  Observe that the created graph is a core graph with respect to $v_0$ because every vertex in the graph is on a circle containing $v_0$, so the output of the reduction is correctly formatted.

  This function is computable in logarithmic space because a loop over the set $U$ requires $O(\log |U|)$ space, a loop over a word $u \in U$ requires $O(\log |u|)$ space, and writing the adjacency matrix of the graph and the corresponding labels can be done in constant space.
  It remains to show the correctness of the reduction.
  Our goal is to show that $\gen{U}$ has rank at most $k$ if and only if the graph $G$ produced by the reduction has the property that $\delta(F(G)) \leq k - 1$, or in other words, that $\delta(F(G)) + 1 \leq k$.

  First we examine the properties of the graph $G$ produced by the reduction.
  Let $G' = F(G)$ and $v'_0 = F_G(v)$.
  Now
  \begin{align*}
    \gen{U} & = \rho(L(G, v_0)) & \qquad \text{ (by \cite[Proposition~3.8]{km02})} \\
            & = \rho(L(G', v'_0)) & \qquad \text{ (by \cite[Lemma~3.4]{km02})} \\
            & = L(G', v'_0), & \qquad \text{ (by \cite[Lemma~2.9]{km02})}
  \end{align*}
  We know $G'$ has a spanning tree $T$ which is geodesic with respect to $v'_0$ by \cite[Lemma~6.6]{km02}.
  Let $Y_T = \{[e]_{G'} \, | \, e \in E(G') \setminus E(T) \}$.
  We know $L(G', v'_0) = \gen{Y_T}$ by \cite[Lemma~6.1]{km02}, so $\gen{U} = \gen{Y_T}$.
  Furthermore, $Y_T$ is Nielsen reduced by \cite[Proposition~6.7]{km02}, so the rank of $\gen{U}$ equals the rank of $\gen{Y_T}$, which equals $|Y_T|$.
  Observe now that
  \begin{align*}
    |Y_T| & = |E(G') \setminus E(T)| & \\
          & = |E(G')| - |E(T)| & \text{ (since } E(T) \subseteq E(G') \text{)} \\
          & = |E(G')| - (|V(G')| - 1) & \text{ (by \autoref{lem:tree})} \\
          & = |E(G')| - |V(G')| + 1 & \\
          & = \delta(G') + 1 & \text{ (by definition of } \delta \text{)}.
  \end{align*}
  Finally, we have that the rank of $\gen{U}$ equals $\delta(G') + 1$.
  With this equality, we conclude the proof by stating that $\gen{U}$ has rank at most $k$ if and only if $\delta(G') + 1 \leq k$, which is what we intended to show.
\end{proof}

\begin{theorem}
  $\FD \in \P$.
\end{theorem}
\begin{proof}
  Stallings' folding process \cite[Algorithm~5.4]{stallings83} is an algorithm which computes the function $F$; it can be implemented in $O(n \log^* n)$ time \cite{touikan06}.
  After computing $F(G)$, it is simple to compare the number of edges in the graph to the number of vertices plus $k$.
\end{proof}

\begin{corollary}
  $\FD$ is \P-complete.
\end{corollary}

\bibliographystyle{plain}
\bibliography{references}

\end{document}
